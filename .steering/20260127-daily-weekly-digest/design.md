# Design: Daily/Weekly Digest Feature

**Feature:** F4: Daily/Weekly Digest
**Priority:** P1
**Date:** 2026-01-27
**Status:** Planning

---

## Implementation Approach

Follow the existing plugin architecture pattern established by F1-F3:
- Command: `commands/paper-digest.md`
- Skill: `skills/paper-digest/SKILL.md`
- Script: `skills/paper-digest/scripts/build_digest.py`

---

## Components to Create

### 1. Command: `commands/paper-digest.md`

Entry point for `/paper-researcher:paper-digest` command.

**Arguments:**
- `--since <timespan>`: Time range for papers (default: 7d)
  - Formats: `1d`, `7d`, `14d`, `30d`
- `--output <path>`: Optional custom output path

**Behavior:**
- Invoke `paper-digest` skill
- Display digest path when complete

### 2. Skill: `skills/paper-digest/SKILL.md`

Workflow orchestration for digest generation.

**Workflow:**
1. Parse `--since` argument to determine date cutoff
2. Run `build_digest.py` script
3. Report digest location and paper count

### 3. Script: `skills/paper-digest/scripts/build_digest.py`

Python script for digest generation.

**Functions:**
- `parse_timespan(timespan: str) -> timedelta`: Parse "7d" format to timedelta
- `load_index(data_dir: Path) -> dict`: Load paper index
- `filter_papers(papers: dict, since: datetime) -> list`: Filter by collected_at
- `group_by_topic(papers: list) -> dict[str, list]`: Group papers by topic
- `load_summary_snippet(paper_id: str, data_dir: Path, max_chars: int) -> str`: Extract snippet
- `build_digest(papers: dict, since: datetime, data_dir: Path) -> str`: Generate markdown
- `main()`: CLI orchestration

**CLI Interface:**
```bash
python build_digest.py --since 7d --data-dir ./data --output data/digests/2026-01-27.md
```

---

## Data Flow

```
User: /paper-researcher:paper-digest --since 7d
           ↓
Command (paper-digest.md)
           ↓
Skill (paper-digest/SKILL.md)
           ↓
Script (build_digest.py)
    → Read data/index/papers.json
    → Filter papers by collected_at >= (now - 7 days)
    → Group by topics
    → Load summary snippets from data/papers/{id}/summary.md
    → Generate markdown
    → Write to data/digests/{date}.md
           ↓
Return: Digest generated at data/digests/2026-01-27.md (5 papers)
```

---

## Output Format

```markdown
# Research Paper Digest

**Generated:** 2026-01-27
**Period:** Last 7 days (2026-01-20 to 2026-01-27)
**Papers:** 5

---

## LLM Agents

### [2401.12345] Agent Framework for LLM Applications
**Authors:** Smith et al. | **Published:** 2026-01-22

> This paper presents a framework for building autonomous LLM agents...

[View Full Summary](../papers/2401.12345/summary.md)

### [2401.12346] Multi-Agent Collaboration
**Authors:** Jones et al. | **Published:** 2026-01-23

> The authors explore collaborative behavior between multiple agents...

[View Full Summary](../papers/2401.12346/summary.md)

---

## Attention Mechanisms

### [2401.12347] Efficient Attention for Long Sequences
**Authors:** Lee et al. | **Published:** 2026-01-21

> Novel attention mechanism that reduces complexity...

[View Full Summary](../papers/2401.12347/summary.md)

---

*Generated by Paper Researcher Plugin*
```

---

## Error Handling

| Scenario | Handling |
|----------|----------|
| No papers in timeframe | Return "No papers collected in the last N days" |
| Index file missing | Return "Paper collection is empty. Run /paper-collect first" |
| Missing summary | Include paper without snippet, note "Summary not available" |
| Invalid timespan format | Return "Invalid timespan format. Use: 1d, 7d, 14d, 30d" |

---

## Files to Create/Modify

| File | Action |
|------|--------|
| `skills/paper-digest/` | Create directory |
| `skills/paper-digest/scripts/` | Create directory |
| `skills/paper-digest/SKILL.md` | Create |
| `skills/paper-digest/scripts/build_digest.py` | Create |
| `commands/paper-digest.md` | Create |
| `tests/test_build_digest.py` | Create |
| `README.md` | Update with new command |

---

## Testing Strategy

### Unit Tests

1. `test_parse_timespan()` - Verify parsing of 1d, 7d, 14d, 30d formats
2. `test_filter_papers()` - Verify date filtering logic
3. `test_group_by_topic()` - Verify topic grouping
4. `test_load_summary_snippet()` - Verify snippet extraction
5. `test_build_digest()` - Verify markdown generation
6. `test_empty_collection()` - Handle no papers
7. `test_no_matching_papers()` - Handle no papers in timeframe
8. `test_missing_summary()` - Handle papers without summaries

### Integration Tests

1. End-to-end digest generation with sample data
2. CLI argument parsing
